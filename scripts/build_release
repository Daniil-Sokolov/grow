#!/bin/bash -e

if [ -d env ]; then
  source env/bin/activate
  rm -rf build

  case "`uname`" in
    "Darwin")
      PLATFORM="Mac";;
    *)
      PLATFORM="`uname`";;
  esac
  VERSION=`cat grow/VERSION`
  FILENAME="Grow-SDK-${PLATFORM}-${VERSION}.zip"

  pyinstaller grow.spec
  chmod +x dist/grow
  cd dist
  zip -r $FILENAME grow
  cd ..
  ./dist/grow
  ./dist/grow build ./grow/testing/testdata/pod/
  echo "Built: dist/${FILENAME}"

  deactivate
else
  echo 'Run ./scripts/setup first.'
  exit 1
fi
